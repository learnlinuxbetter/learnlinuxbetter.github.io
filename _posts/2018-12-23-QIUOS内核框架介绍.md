---
title: QIUOS内核框架介绍
date: 2018-12-23 00:00:00
categories: QIUOS
tags:

---

QiuOS继承于Minix系统，因此选择了走微内核路线。所谓微内核意思是内核只承担一小部分必要的任务，如消息传递、硬件中断处理、进程调度以及部分I/O。绝大多数都交给了处于Ring1特权级运行的系统任务，内核只是担当“邮差”的角色，在各个进程之间传递消息。

而与之对应的宏内核则事无巨细都通过系统调用交给内核来处理，Linux走的就是宏内核路线。Linus和Tanenbaum之间曾爆发了一段关于宏内核和微内核的争论，Linus坚持认为宏内核在效率方面更高，但事实证明微内核在效率方面能做的一样好，微内核取得了胜利。

接下来我们看QiuOS的内核框架：



![img](https://qiutianshu.files.wordpress.com/2018/12/QiuOS%E6%A1%86%E6%9E%B6.png?w=525&h=456)



用户程序通过系统提供的函数库中一些列函数来实现其功能，这些函数基本与C语言标准函数保持了同名同用法，所以在使用习惯上不会有太大差别。函数库通过IPC的系统调用接口向运行在Ring1特权级的系统任务发送消息，这些任务包括文件系统（task_fs）、内存管理（task_mm）、字符设备（task_tty）、硬盘驱动（task_hd）、系统任务（task_sys）。系统任务完成相应的操作后也通过IPC系统调用接口向用户程序返回执行结果。QiuOS中系统任务被赋予了全部I/O端口的操作权限，所以可以在Ring1特权级下直接操作硬件端口，完成诸如硬盘读写、VGA控制这些功能，因此系统任务也可以被称为驱动。

总结来看要完成一个系统函数，需要经过“用户程序、内核、系统任务、内核、用户程序”这五个步骤。内核在这里只是负责消息传递，主要工作都是由系统任务来完成，所以QiuOS唯一的系统调用只有IPC系统调用。

在进程调度策略上，使用了固定时间片不可抢占的优先级调度算法，进程的优先级越高则分配越多的时间片，而且只有在当前进程的时间片使用完，并且下一个时钟中断到来的时候发生进程切换。